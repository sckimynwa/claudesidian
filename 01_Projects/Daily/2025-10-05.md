### Personal
- [x] Antifragile Frontend 광고 돌리기 (Yes 24로 돌리고 예산 10만원내로 연휴 기간 내내 돌려두기)
- [ ] BMNR / MSTR 기업 분석 제대로 해두기 / 이더리움 생태계에 대한 이해도 높여두기
- [ ] Fitness (달리기 3km / 상체 근력운동)
- [ ] 기술 공화국에 대한 글 하나 쓰기

### ThePlato
- [x] AskTiro Vector Embedding 속도 체크 / 성능 확인
- [x] IVFFlat Index로 이전 / 이후 성능 테스트
- [x] Update Query도 제대로 동작 안했음.
- [ ] AskTiro 이후 태스크 정리하기 (렌더링 / 프롬프트 태스크)
- [ ] 캘린더 아키텍쳐 다시 설계해두기 & Outlook 연동 준비
- [ ] Tiro MCP 인증 관련 정리해두기
- [x] 프롬프트 태스크 정리 필요함. (Grok-4-fast-reasoning / GPT-5의 프롬프트 개선 태스크)
- [ ] 템플릿 생성 안되는 이슈 해결하기
- [ ] 티로 시스템 QA 관련 방법 리서치
- [x] STT 에러 발생시 자동 재연결 로직 구현


---
### Session 1
Obsidian에서 Claude Code를 더 잘 활용할 수 있는 방법을 잘 알아두는게 중요할 듯
- 터미널을 옵시디언 사이드바에 띄우는 방식 / 아직 별도로 지원하진 않아서 운영체제 화면을 split 해두고 사용하는게 좋을 듯.
- /daily-review 같은 에이전트를 두고 리뷰로 한번 사용해보겠음. claude비용이 너무 많이 나오려나 싶긴한데, 나중에 grok으로 바꾸면 되니까 문제없음.

AskTiro 관련된 내용
- 속도가 너무 느림. 처음 30%는 정말 빠르게 되다가 절반 정도 다 되어가는 시점에서는 속도가 급격히 느려지고 있음. 이 정도 속도라면 연휴 기간 내에 제대로 끝내기 어려울듯. 다만 속도가 linear하게 증가하는게 아니라 초반 1M개 정도의 block은 빠르게 되었다가 갑자기 느려졌음. 이것 원인 파악하는게 오전에 가장 중요한 태스크임.
- 아래와 같이 계속 Skipping vaccum of ~ 에러가 나고 있음.
- HNSW를 제한된 인스턴스에서 생성하면서 발생한 이슈였음. 다음 세션에 조금더 깊이 분석하는게 필요함. HNSW의 동작원리와 현재 인스턴스 상의 제약등을 잘 정리해두겠음.

```
2025-10-02 01:55:43 UTC::@:[1335]:LOG:  checkpoint starting: time
2025-10-02 01:55:49 UTC::@:[4041]:LOG:  skipping vacuum of "paragraph_embedding" --- lock not available
2025-10-02 01:56:04 UTC::@:[4056]:LOG:  skipping vacuum of "paragraph_embedding" --- lock not available
2025-10-02 01:56:19 UTC::@:[4070]:LOG:  skipping vacuum of "paragraph_embedding" --- lock not available
2025-10-02 01:56:34 UTC::@:[4084]:LOG:  skipping vacuum of "paragraph_embedding" --- lock not available
2025-10-02 01:56:49 UTC::@:[4099]:LOG:  skipping vacuum of "paragraph_embedding" --- lock not available
```

### Session 2
HNSW의 한계와 IVFFlat으로의 이전에 대한 여러 맥락들을 정리해두겠음.
인덱스 생성을 위해 메모리를 확 키웠다가 모든 것들 제대로 처리한 이후 다시 인스턴스 내리는 방식을 사용해보아야 할듯.

- 현재의 db.t4g.xlarge(16GB RAM) > db.r6g.2xlarge(64GB RAM)으로 바꾼뒤 다시 시도할 예정. 이후 인덱스 완전히 생성되고 나면 그때 다시 인스턴스 내리는 식으로 대응하려 함
- 확인해보니 기존 유저의 user_id 이 값도 업데이트가 제대로 안되었었음. 이 부분도 수정 대응 필요함
- 우선 다음과 같은 순서로 진행하면 될듯

1. IVFFlat 인덱스 생성
2. UPDATE metadata 관련필드 다시 수행
3. 기존 인덱스 삭제


### Session 3
- HNSW가 너무 오래 걸린 이유: IO 성능이 너무 안나왔고, 사용할 수 있는 메모리가 너무 적어서 매번 Disk IO 를 거치느라 너무 오래 걸림.
- HNSW는 어떤 식으로 동작하는가?
	- 그래프 구조를 메모리에 로드하면서 진행됨. 초반에는 메모리 로드가 잘 되어 빠르게 진행되었지만, 데이터가 쌓일수록 메모리를 초과함.
	- 최하층인 layer 0에는 모든 데이터 노드가 존재. 상위 층으로 갈수록 점점 작은 노드가 존재.
	- 각 노드는 해당 층에서 M, M * 2(최하 층만)의 이웃과 연결. 
	- 실제 데이터보다 인덱스의 크기가 더 클 수 있음.
	- 구조상 데이터를 중복으로 저장하기 때문에 인덱스의 크기가 매우 큼.
- IVFFlat
	- Inverted File with Flat Quantization
	- 벡터를 압축하지 않고 원본 그대로 저장함
	- K-means Clustering -> 전체 벡터 공간을 lists 개수 만큼의 영역으로 분할함. 이때 샘플링된 데이터로 centroid를 학습.
- 아직 명확하게 원리를 이해하고 있지는 못한듯.
- 그런데 IVFFlat이 메모리를 더 적게 사용하고, 인덱스 구축 속도도 빠르다는 점에서 고려해야 하는 옵션인 건 맞는 듯. 다만 사용량이 더 많아져서 벡터의 개수가 1억개에 달하게 되면 이 때는 새로운 방식을 고려하긴 해야 할듯 함.


psql -h tiro-vector.cxky6cc0ywvx.ap-northeast-2.rds.amazonaws.com -p 5432 -U tiro_vector -d tiro_vector -f migrate-paragraphembedding-column.sql > update.log 2>&1


### Session 4
Antifragile Frontend 광고 돌리기 연휴 기간 동안
- yes24 링크 위주로 돌리기 캐치프레이즈 위주로 돌리기
- 글 올리고 yes24 링크를 달았음. 2~3 문장 정도만 달아야 첫 화면에 바로 링크까지 보이기 때문에 그렇게 올려두었음.
- 실시간 랭킹 등은 최근 1~2주간의 판매량이 중요함. 이를 위한 부스팅을 조금 더 해두기로 함
- 지금까지 총 몇권을 팔았는지는 알 수 없으려나
- 어떤 식의 키워드가 돈이 잘 되는지를 확인해두어야 할듯


### Session 5
- ClovaSTTClient에서 연결이 onError로 끊어졌을 때, 자동으로 재연결 시도하는 매커니즘 구현해두기. 실제로 multi-server instance에서 제대로 동작하는지 확인이 필요함
- 실제로 몇몇 userId에 대해 배포해두고 테스트하는게 필요함. 전체 적용이 어려울 수 있음.
